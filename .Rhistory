setwd("C:/Users/Joaquin/Desktop/UdeSA/Maestría en Economía/Herramientas Computacionales Para Investigación/Herramientas-Computacionales-Liwski-Sury-Trabajo-Final")
#Cargo Paquetes
suppressMessages({
if(!require("pacman")) install.packages("pacman")
pacman::p_load("tidyverse","readxl","haven","sf","rgdal","RecordLinkage",
"rmapshaper","geojsonio", "gganimate","gapminder","sfheaders",
"xtable", "scales")
})
rm(list=ls())
#cargo los dta
inputfolder<-"Data, figuras y do originales/Data-Original/"
dtas<-list.files(path= inputfolder, recursive = TRUE, include.dirs = TRUE)
for(file in dtas) {
# nombre al cual le asigno cada dta
obj_name <- gsub(".dta", "", file)
#open file
dta_file <- read_dta(paste0(inputfolder,file))
# Assign
assign(obj_name, dta_file)
}
#Borro lo que este de mas
rm(dta_file,dtas,file,obj_name)
#Limpio nombres de merge
merge_ss_eneu_final$descripcion_municipio[which(merge_ss_eneu_final$descripcion_municipio=="")]<-merge_ss_eneu_final$name_ss[which(merge_ss_eneu_final$descripcion_municipio=="")]
#merge_ss_eneu_final$descripcion_municipio<-str_to_title(iconv(merge_ss_eneu_final$descripcion_municipio, to = 'Latin1'))
merge_ss_eneu_final$descripcion_municipio<-str_to_title(merge_ss_eneu_final$descripcion_municipio)
#Inporto SHP
#municipioshp <- read_sf("Data, figuras y do originales/municipios_mx_feb2018/municipios_mx_feb2018.shp") #faster
municipio <- st_read("Data, figuras y do originales/municipios_mx_feb2018/municipios_mx_feb2018.shp", options = "ENCODING=WINDOWS-1252")
municipio <- ms_simplify(municipio) #para que no sea tan pesado
municipio$CVEGEO<-as.numeric(municipio$CVEGEO)
municipio<-municipio%>%left_join(merge_ss_eneu_final, by=c("CVEGEO"="municipality"))
View(Population_Poverty)
#Junto demas en other
affiliated<-affiliated%>%group_by(year)%>%
mutate("other"=sum(ISSSTE,SEDENA,SEMAR,PEMEX,na.rm=T))
ggplot(affiliated,aes(x=year))+
geom_line(aes(y=SeguroPopular,color="Seguro Popular"))+
geom_line(aes(y=IMSS,color="IMSS"),linetype = "dashed")+
geom_line(aes(y = other,color="Otros"),linetype = 3,size=1)+
labs(x = "Fecha",   #cambio detalles
color = "",
title = "Número de Afiliados al Seguro Popular, IMSS y otros proveedores de salud con SP: 2000-2011",
subtitle = "Figura 3",
caption = "Fuente: IMSS",
y="Afiliados a servicios de salud (en millones)") +
theme_minimal() +#lo pongo bonito
theme(legend.position="bottom")
ggsave("figura3.eps", plot = last_plot(),
path = "outputs",
width = 200, height = 135, units = "mm") #lo guardo como eps
View(Population_Poverty)
View(caract_muni)
View(Population_Poverty)
municipiopoverty<-municipio%>%left_join(Population_Poverty, by=c("cvemun")) #join con caracteristicas de municipio
#PLOT poverty
ggplot(municipiopoverty) +
geom_sf(colour='black', aes(fill=insured), size = 0.000005)+ #tipo de figura y aes
labs(x = "Longitud", y = "Latitud",   #cambio detalles
fill = "",
title = "Porcentaje de Poblacion en Pobreza Alimentaria",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)+
scale_fill_gradient2(low = "#FF6962", mid="#FDFD96", high = "#77DD77",midpoint = 50 ,limits=c(0,100))
View(municipiopoverty)
#PLOT poverty
ggplot(municipiopoverty) +
geom_sf(colour='black', aes(fill=pobreza_alim2000), size = 0.000005)+ #tipo de figura y aes
labs(x = "Longitud", y = "Latitud",   #cambio detalles
fill = "",
title = "Porcentaje de Poblacion en Pobreza Alimentaria (Indigencia)",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)+
scale_fill_gradient2(low = "#FF6962", mid="#FDFD96", high = "#77DD77",midpoint = 50 ,limits=c(0,100))
#PLOT poverty
ggplot(municipiopoverty) +
geom_sf(colour='black', aes(fill=pobreza_alim2000), size = 0.000005)+ #tipo de figura y aes
labs(x = "Longitud", y = "Latitud",   #cambio detalles
fill = "",
title = "Porcentaje de Poblacion en Pobreza Alimentaria (Indigencia)",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)+
scale_fill_gradient2(high = "#FF6962", mid="#FDFD96", low = "#77DD77",midpoint = 50 ,limits=c(0,100))
#PLOT poverty
ggplot(municipiopoverty) +
geom_sf(colour='black', aes(fill=pobreza_alim2000), size = 0.000005)+ #tipo de figura y aes
labs(x = "Longitud", y = "Latitud",   #cambio detalles
fill = "",
title = "Porcentaje de Poblacion en Pobreza Alimentaria (Indigencia)",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)+
scale_fill_gradient2(high = "#FF6962", mid="#FDFD96", low = "#77DD77",midpoint = 40 ,limits=c(0,100))
#PLOT poverty
ggplot(municipiopoverty) +
geom_sf(colour='black', aes(fill=pobreza_alim2000), size = 0.000005)+ #tipo de figura y aes
labs(x = "Longitud", y = "Latitud",   #cambio detalles
fill = "",
title = "Porcentaje de Poblacion en Pobreza Alimentaria (Indigencia)",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)+
scale_fill_gradient2(high = "#FF6962", mid="#FDFD96", low = "#77DD77",midpoint = 30 ,limits=c(0,100))
#PLOT poverty INGRESOS
ggplot(municipiopoverty) +
geom_sf(colour='black', aes(fill=pobreza_pat2000), size = 0.000005)+ #tipo de figura y aes
labs(x = "Longitud", y = "Latitud",   #cambio detalles
fill = "",
title = "Porcentaje de Poblacion en Pobreza por Ingresos",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)+
scale_fill_gradient2(high = "#FF6962", mid="#FDFD96", low = "#77DD77",midpoint = 40 ,limits=c(0,100))
municipiopoverty<-municipio%>%left_join(Population_Poverty, by=c("cvemun")) #join con caracteristicas de municipio
#PLOT poverty alimentaria
ggplot(municipiopoverty) +
geom_sf(colour='black', aes(fill=pobreza_alim2000), size = 0.000005)+ #tipo de figura y aes
labs(x = "Longitud", y = "Latitud",   #cambio detalles
fill = "",
title = "Porcentaje de Poblacion en Pobreza Alimentaria (Indigencia)",
subtitle = "por Municipio, Mexico 2000",
caption = "Fuente: Censo General de Población y Vivienda 2000") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)+
scale_fill_gradient2(high = "#FF6962", mid="#FDFD96", low = "#77DD77",midpoint = 40 ,limits=c(0,100))
ggsave("povertyalim.eps", plot = last_plot(),
path = "outputs",
width = 200, height = 135, units = "mm") #lo guardo como eps
#PLOT poverty INGRESOS
ggplot(municipiopoverty) +
geom_sf(colour='black', aes(fill=pobreza_pat2000), size = 0.000005)+ #tipo de figura y aes
labs(x = "Longitud", y = "Latitud",   #cambio detalles
fill = "",
title = "Porcentaje de Poblacion en Pobreza por Ingresos",
subtitle = "por Municipio, Mexico 2000",
caption = "Fuente: Censo General de Población y Vivienda 2000") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)+
scale_fill_gradient2(high = "#FF6962", mid="#FDFD96", low = "#77DD77",midpoint = 40 ,limits=c(0,100))
ggsave("povertypat.eps", plot = last_plot(),
path = "outputs",
width = 200, height = 135, units = "mm") #lo guardo como eps
#borramos todo lo aca creado
rm(list= "municipiopoverty")
