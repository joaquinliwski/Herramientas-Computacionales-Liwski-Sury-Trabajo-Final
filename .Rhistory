legend.position = c(.8,.8),
legend.background = element_blank()
)+
scale_fill_gradient2(high = "#FF6962", mid="#FDFD96", low = "#77DD77",
midpoint = 0.02 ,limits=c(0,0.04))
ggsave("unemployement.eps", plot = last_plot(),
path = "outputs",
width = 200, height = 135, units = "mm") #lo guardo como eps
#Cargo Paquetes
setwd("C:/Users/Joaquin/Desktop/UdeSA/Maestría en Economía/Productividad - Evidencia y Política Pública/Examen")
suppressMessages({
if(!require("pacman")) install.packages("pacman")
pacman::p_load("tidyverse","ggplot2","readxl","ggthemes","haven","xtable",
"stargazzer","Hmisc")
})
rm(list=ls())
#Datos
ENDEI<-read_sav("ENDEI II_anonimizada_Junio_2019.sav")
#Inciso a
#Productividad como valor medio de los 3 anios
ENDEI$Va_tr<-rowMeans(ENDEI%>%select(Va_tr14,Va_tr15,Va_tr16),na.rm = T)
#Ramas de dos digitos
ENDEI$Rama_act_2D<-as.numeric(substr(ENDEI$Rama_act, 1, 2))
ENDEI$Rama_act_2D<-ifelse(ENDEI$Rama_act_2D==99,9999,ENDEI$Rama_act_2D)
ENDEI$Rama_act_2D<-ifelse(ENDEI$Rama_act_2D==30,3012,ENDEI$Rama_act_2D)
#Para trabajar en R paso de code a label
labels<-bind_cols(rownames(as.data.frame(attributes(ENDEI$Rama_act)$labels)),
as.data.frame(attributes(ENDEI$Rama_act)$labels))
labels[nrow(labels) + 1,] <- data.frame("Vehiculos y Autopartes",34)
colnames(labels)<-c("Rama_act_label_2D","Rama_act_2D")
#Join
ENDEI<-right_join(labels,ENDEI)
#media y desvios ponderada por rama de actividad
tablaA<-ENDEI%>%group_by(Rama_act_label_2D)%>%summarise(Media=mean(Va_tr,na.rm=T),
SD=sd(Va_tr,na.rm=T),
MediaW=wtd.mean(Va_tr,Factor2,na.rm=T),
SDW=sqrt(wtd.var(Va_tr,Factor2,na.rm=T)),
n())
tablaATot<-ENDEI%>%summarise(Media=mean(Va_tr,na.rm=T),
SD=sd(Va_tr,na.rm=T),
MediaW=wtd.mean(Va_tr,Factor2,na.rm=T),
SDW=sqrt(wtd.var(Va_tr,Factor2,na.rm=T)),
n())
tablaA<-bind_rows(tablaA,tablaATot)
tablaA[nrow(tablaA),]$Rama_act_label_2D <- "Total Industria"
xtable(tablaA,caption="Promedios y Desvios de Productividad por Sector.")
#Inciso 2
ENDEI2<-ENDEI
ENDEI2$id<-ENDEI2$Rama_act_label_2D
ENDEI2<-ENDEI2%>%select(-Rama_act_label_2D)
plot_dens<-ggplot(ENDEI)+
geom_density(data=ENDEI2, fill = "grey85",colour = "grey85", aes(log(Va_tr),group=id),alpha = 0.02,)+
geom_density(alpha = 0.5, aes(log(Va_tr),fill = Rama_act_label_2D, colour = Rama_act_label_2D),colour="cornflowerblue",fill="skyblue")+
facet_wrap( ~ Rama_act_label_2D,ncol=4)+
xlim(9.5, 16.5)+
theme_minimal()+
theme(legend.position="none")+
xlab("Logritmo Natral de VA por trabajador")+
ylab( "Densidad")+
labs( caption = "Fuente: ENDEI II")
ggsave("Distribucion Productividad Trabajo.eps", plot = plot_dens,
path = "C:/Users/Joaquin/Desktop/UdeSA/Maestría en Economía/Productividad - Evidencia y Política Pública/Examen",
width = 170,  height=220, units = "mm")
hist(x = caract_muni$insured, prob = TRUE, main = "Población mexicana asegurada por municipio en el 2000",
xlab = "Asegurados en %", ylab = "Densidad",
col = "grey95",
breaks = 20)
grid(nx = NA, ny = NULL, lty = 2, col = "gray", lwd = 1)
hist(x = caract_muni$insured, prob = TRUE, main = "Poblacion mexicana asegurada por municipio en el2000",
xlab = "Asegurados en %", ylab = "Densidad",
col = "#grey95",
breaks = 20,
add = TRUE)
lines(density(caract_muni$insured), lwd = 2, col = 'black')
setwd("C:/Users/Joaquin/Desktop/UdeSA/Maestría en Economía/Herramientas Computacionales Para Investigación/Herramientas-Computacionales-Liwski-Sury-Trabajo-Final")
#Cargo Paquetes
suppressMessages({
if(!require("pacman")) install.packages("pacman")
pacman::p_load("tidyverse","readxl","haven","sf","rgdal","RecordLinkage",
"rmapshaper","geojsonio", "gganimate","gapminder","sfheaders",
"xtable", "scales")
})
rm(list=ls())
#cargo los dta
inputfolder<-"Data, figuras y do originales/Data-Original/"
dtas<-list.files(path= inputfolder, recursive = TRUE, include.dirs = TRUE)
for(file in dtas) {
# nombre al cual le asigno cada dta
obj_name <- gsub(".dta", "", file)
#open file
dta_file <- read_dta(paste0(inputfolder,file))
# Assign
assign(obj_name, dta_file)
}
#Borro lo que este de mas
rm(dta_file,dtas,file,obj_name)
#Limpio nombres de merge
merge_ss_eneu_final$descripcion_municipio[which(merge_ss_eneu_final$descripcion_municipio=="")]<-merge_ss_eneu_final$name_ss[which(merge_ss_eneu_final$descripcion_municipio=="")]
#merge_ss_eneu_final$descripcion_municipio<-str_to_title(iconv(merge_ss_eneu_final$descripcion_municipio, to = 'Latin1'))
merge_ss_eneu_final$descripcion_municipio<-str_to_title(merge_ss_eneu_final$descripcion_municipio)
#Inporto SHP
#municipioshp <- read_sf("Data, figuras y do originales/municipios_mx_feb2018/municipios_mx_feb2018.shp") #faster
municipio <- st_read("Data, figuras y do originales/municipios_mx_feb2018/municipios_mx_feb2018.shp", options = "ENCODING=WINDOWS-1252")
municipio <- ms_simplify(municipio) #para que no sea tan pesado
municipio$CVEGEO<-as.numeric(municipio$CVEGEO)
municipio<-municipio%>%left_join(merge_ss_eneu_final, by=c("CVEGEO"="municipality"))
hist(x = caract_muni$insured, prob = TRUE, main = "Población mexicana asegurada por municipio en el 2000",
xlab = "Asegurados en %", ylab = "Densidad",
col = "grey95",
breaks = 20)
grid(nx = NA, ny = NULL, lty = 2, col = "gray", lwd = 1)
hist(x = caract_muni$insured, prob = TRUE, main = "Poblacion mexicana asegurada por municipio en el2000",
xlab = "Asegurados en %", ylab = "Densidad",
col = "#grey95",
breaks = 20,
add = TRUE)
lines(density(caract_muni$insured), lwd = 2, col = 'black')
setEPS()
postscript(file="outputs/histinsured.eps",width = 7.87402, height = 5.90551)
hist(x = caract_muni$insured, prob = TRUE, main = "Población mexicana asegurada por municipio en el 2000",
xlab = "Asegurados en %", ylab = "Densidad",
col = "grey95",
breaks = 20)
grid(nx = NA, ny = NULL, lty = 2, col = "gray", lwd = 1)
hist(x = caract_muni$insured, prob = TRUE, main = "Poblacion mexicana asegurada por municipio en el2000",
xlab = "Asegurados en %", ylab = "Densidad",
col = "#grey95",
breaks = 20,
add = TRUE)
lines(density(caract_muni$insured), lwd = 2, col = 'black')
dev.off()
dev.off()
dev.off()
municipiosp<-municipio%>%left_join(benef_SP_2002_2009, by=c("cvemun")) #join con caracteristicas de municipio
#armamos date variables
municipiosp$month<-3*municipiosp$quarter
municipiosp$date<-as.Date(paste0(municipiosp$year,"-",municipiosp$month,"-01"))
options(scipen=999)#para que no aparezca con scientific notation
#date variable NA si ind<10 o NA (con replace porque ifelse rompe el formato)
municipiosp$date<-replace(municipiosp$date,which(municipiosp$ind<10),NA)
municipiosp$date<-replace(municipiosp$date,which(is.na(municipiosp$ind)),NA)
#primer fecha donde ind es mayor a diez como entrada al programa de un municipio.
entrydate<-municipiosp%>%group_by(cvemun)%>%slice(which.min(date))
entrydate<-entrydate%>%left_join(caract_muni, by=c("cvemun"))
ggplot(entrydate,aes(x=date,y=log(populationb)))+
geom_point(alpha=.3,color="#b8d8be")+
geom_smooth(method = lm, se = FALSE,color="black")+ #para ver direccion
annotate("text", x = as.Date("2008-06-01"), y = 13,
label = expression(beta*"=-40.14"), parse = TRUE)+
labs(x = "Fecha de Entrada", y = "Poblacion",   #cambio detalles
fill = "",
title = "Fecha de Adopcion SP vs Poblacion",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000 - IMSS") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)
ggsave("Correlacion Cami.eps", plot = last_plot(),
path = "outputs",
width = 200, height = 135, units = "mm") #lo guardo como eps
rm(list = c("municipiosp","entrydate"))
ggplot(entrydate,aes(x=date,y=log(populationb)))+
geom_point(alpha=.5,color="#b8d8be")+
geom_smooth(method = lm, se = FALSE,color="black")+ #para ver direccion
annotate("text", x = as.Date("2008-06-01"), y = 13,
label = expression(beta*"=-40.14"), parse = TRUE)+
labs(x = "Fecha de Entrada", y = "Poblacion",   #cambio detalles
fill = "",
title = "Fecha de Adopcion SP vs Poblacion",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000 - IMSS") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)
ggsave("Correlacion Cami.eps", plot = last_plot(),
path = "outputs",
width = 200, height = 135, units = "mm") #lo guardo como eps
rm(list = c("municipiosp","entrydate"))
municipiosp<-municipio%>%left_join(benef_SP_2002_2009, by=c("cvemun")) #join con caracteristicas de municipio
#armamos date variables
municipiosp$month<-3*municipiosp$quarter
municipiosp$date<-as.Date(paste0(municipiosp$year,"-",municipiosp$month,"-01"))
options(scipen=999)#para que no aparezca con scientific notation
#date variable NA si ind<10 o NA (con replace porque ifelse rompe el formato)
municipiosp$date<-replace(municipiosp$date,which(municipiosp$ind<10),NA)
municipiosp$date<-replace(municipiosp$date,which(is.na(municipiosp$ind)),NA)
#primer fecha donde ind es mayor a diez como entrada al programa de un municipio.
entrydate<-municipiosp%>%group_by(cvemun)%>%slice(which.min(date))
entrydate<-entrydate%>%left_join(caract_muni, by=c("cvemun"))
ggplot(entrydate,aes(x=date,y=log(populationb)))+
geom_point(alpha=.5,color="#b8d8be")+
geom_smooth(method = lm, se = FALSE,color="black")+ #para ver direccion
annotate("text", x = as.Date("2008-06-01"), y = 13,
label = expression(beta*"=-40.14"), parse = TRUE)+
labs(x = "Fecha de Entrada", y = "Poblacion",   #cambio detalles
fill = "",
title = "Fecha de Adopcion SP vs Poblacion",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000 - IMSS") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)
ggsave("Correlacion Cami.eps", plot = last_plot(),
path = "outputs",
width = 200, height = 135, units = "mm") #lo guardo como eps
rm(list = c("municipiosp","entrydate"))
ggplot(entrydate,aes(x=date,y=log(populationb)))+
geom_point(alpha=.5,color="#b8d8be")+
geom_smooth(method = lm, se = FALSE,color="black")+ #para ver direccion
annotate("text", x = as.Date("2008-06-01"), y = 13,
label = expression(beta*"=-40.14"), parse = TRUE)+
labs(x = "Fecha de Entrada", y = "Poblacion",   #cambio detalles
fill = "",
title = "Fecha de Adopcion SP vs Poblacion",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000 - IMSS") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)
municipiosp<-municipio%>%left_join(benef_SP_2002_2009, by=c("cvemun")) #join con caracteristicas de municipio
#armamos date variables
municipiosp$month<-3*municipiosp$quarter
municipiosp$date<-as.Date(paste0(municipiosp$year,"-",municipiosp$month,"-01"))
options(scipen=999)#para que no aparezca con scientific notation
#date variable NA si ind<10 o NA (con replace porque ifelse rompe el formato)
municipiosp$date<-replace(municipiosp$date,which(municipiosp$ind<10),NA)
municipiosp$date<-replace(municipiosp$date,which(is.na(municipiosp$ind)),NA)
#primer fecha donde ind es mayor a diez como entrada al programa de un municipio.
entrydate<-municipiosp%>%group_by(cvemun)%>%slice(which.min(date))
entrydate<-entrydate%>%left_join(caract_muni, by=c("cvemun"))
ggplot(entrydate,aes(x=date,y=log(populationb)))+
geom_point(alpha=.5,color="#b8d8be")+
geom_smooth(method = lm, se = FALSE,color="black")+ #para ver direccion
annotate("text", x = as.Date("2008-06-01"), y = 13,
label = expression(beta*"=-40.14"), parse = TRUE)+
labs(x = "Fecha de Entrada", y = "Poblacion",   #cambio detalles
fill = "",
title = "Fecha de Adopcion SP vs Poblacion",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000 - IMSS") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)
ggsave("Correlacion Cami.eps", plot = last_plot(),
path = "outputs",
width = 200, height = 160, units = "mm") #lo guardo como eps
rm(list = c("municipiosp","entrydate"))
municipiosp<-municipio%>%left_join(benef_SP_2002_2009, by=c("cvemun")) #join con caracteristicas de municipio
#armamos date variables
municipiosp$month<-3*municipiosp$quarter
municipiosp$date<-as.Date(paste0(municipiosp$year,"-",municipiosp$month,"-01"))
options(scipen=999)#para que no aparezca con scientific notation
#date variable NA si ind<10 o NA (con replace porque ifelse rompe el formato)
municipiosp$date<-replace(municipiosp$date,which(municipiosp$ind<10),NA)
municipiosp$date<-replace(municipiosp$date,which(is.na(municipiosp$ind)),NA)
#primer fecha donde ind es mayor a diez como entrada al programa de un municipio.
entrydate<-municipiosp%>%group_by(cvemun)%>%slice(which.min(date))
entrydate<-entrydate%>%left_join(caract_muni, by=c("cvemun"))
ggplot(entrydate,aes(x=date,y=log(populationb)))+
geom_point(color="#b8d8be")+
geom_smooth(method = lm, se = FALSE,color="black")+ #para ver direccion
annotate("text", x = as.Date("2008-06-01"), y = 13,
label = expression(beta*"=-40.14"), parse = TRUE)+
labs(x = "Fecha de Entrada", y = "Poblacion",   #cambio detalles
fill = "",
title = "Fecha de Adopcion SP vs Poblacion",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000 - IMSS") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)
ggsave("Correlacion Cami.eps", plot = last_plot(),
path = "outputs",
width = 200, height = 160, units = "mm") #lo guardo como eps
rm(list = c("municipiosp","entrydate"))
municipiosp<-municipio%>%left_join(benef_SP_2002_2009, by=c("cvemun")) #join con caracteristicas de municipio
#armamos date variables
municipiosp$month<-3*municipiosp$quarter
municipiosp$date<-as.Date(paste0(municipiosp$year,"-",municipiosp$month,"-01"))
options(scipen=999)#para que no aparezca con scientific notation
#date variable NA si ind<10 o NA (con replace porque ifelse rompe el formato)
municipiosp$date<-replace(municipiosp$date,which(municipiosp$ind<10),NA)
municipiosp$date<-replace(municipiosp$date,which(is.na(municipiosp$ind)),NA)
#primer fecha donde ind es mayor a diez como entrada al programa de un municipio.
entrydate<-municipiosp%>%group_by(cvemun)%>%slice(which.min(date))
entrydate<-entrydate%>%left_join(caract_muni, by=c("cvemun"))
ggplot(entrydate,aes(x=date,y=log(populationb)))+
geom_point(color="#b8d8be")+
geom_smooth(method = lm, se = FALSE,color="black")+ #para ver direccion
annotate("text", x = as.Date("2008-06-01"), y = 13,
label = expression(beta*"=-40.14"), parse = TRUE)+
labs(x = "Fecha de Entrada", y = "Poblacion",   #cambio detalles
fill = "",
title = "Fecha de Adopcion SP vs Poblacion",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000 - IMSS") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)
ggsave("Correlacion Cami.eps", plot = last_plot(),
path = "outputs",
width = 200, height = 200, units = "mm") #lo guardo como eps
rm(list = c("municipiosp","entrydate"))
View(employees)
#creamos employement agregado
employement<-employees%>%full_join(employers,by=c("municipio","year","quarter"))
employementfull<-employement%>%group_by(year,quarter)%>%
summarise("employees"=sum(emp_t,na.rm=T),"employers"=sum(pat_t,na.rm=T))
#agregamos date variable
employementfull$month<-3*employementfull$quarter
employementfull$date<-as.Date(paste0(employementfull$year,"-",employementfull$month,"-01"))
#Empleo por lo general no varia tanto, mas estático.
#Junto datos, por municipio empleados y empleadores promedio para el periodo por municipio
empcaract<-employement%>%left_join(municipio)%>%left_join(caract_muni, by=c("cvemun"))%>%
select(emp_t,pat_t,populationb,year,quarter,municipio)%>%group_by(municipio)%>%
summarise("employees"=mean(emp_t/populationb,na.rm=T),"employers"=mean(pat_t/populationb,na.rm=T))%>%
right_join(municipio) #le devolvemos la hermosa geometria
empcaract<-st_as_sf(empcaract) #SF once again
min(empcaract$employees,na.rm=TRUE)
max(empcaract$employees,na.rm=TRUE)
View(employees)
View(empcaract)
ggplot() +
geom_sf(data=empcaract,colour='black', aes(fill=100*employees), size = 0.000005)+ #tipo de figura y aes
labs(x = "Longitud", y = "Latitud",   #cambio detalles
fill = "Porcentaje",
title = "Promedio Empleados (IMSS) sobre Poblacion",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000 - IMSS") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)+
scale_fill_gradient2(low = "#FF6962", mid="#FDFD96", high = "#77DD77",midpoint = 20 ,limits=c(0,50))
ggsave("employeespob.eps", plot = last_plot(),
path = "outputs",
width = 200, height = 135, units = "mm") #lo guardo como eps
#Hay tres que tienen mas empleados que poblacion
municipiosp<-municipio%>%left_join(benef_SP_2002_2009, by=c("cvemun")) #join con caracteristicas de municipio
#armamos date variables
municipiosp$month<-3*municipiosp$quarter
municipiosp$date<-as.Date(paste0(municipiosp$year,"-",municipiosp$month,"-01"))
options(scipen=999)#para que no aparezca con scientific notation
#date variable NA si ind<10 o NA (con replace porque ifelse rompe el formato)
municipiosp$date<-replace(municipiosp$date,which(municipiosp$ind<10),NA)
municipiosp$date<-replace(municipiosp$date,which(is.na(municipiosp$ind)),NA)
#primer fecha donde ind es mayor a diez como entrada al programa de un municipio.
entrydate<-municipiosp%>%group_by(cvemun)%>%slice(which.min(date))
entrydate<-entrydate%>%left_join(caract_muni, by=c("cvemun"))
ggplot(entrydate,aes(x=date,y=log(populationb)))+
geom_point(color="#b8d8be")+
geom_smooth(method = lm, se = FALSE,color="black")+ #para ver direccion
annotate("text", x = as.Date("2008-06-01"), y = 13,
label = expression(beta*"=-40.14"), parse = TRUE)+
labs(x = "Fecha de Entrada", y = "Poblacion",   #cambio detalles
fill = "",
title = "Fecha de Adopcion SP vs Poblacion",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000 - IMSS") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)
ggsave("Correlacion Cami.eps", plot = last_plot(),
path = "outputs",
width = 200, height = 200, units = "mm") #lo guardo como eps
rm(list = c("municipiosp","entrydate"))
municipiocaract<-municipio%>%left_join(caract_muni, by=c("cvemun")) #join con caracteristicas de municipio
#PLOT URBANOS VS RURALES
ggplot(municipiocaract) +
geom_sf(colour='black', aes(fill=as.factor(urban),color=as.factor(urban)), size = 0.000005)+ #tipo de figura y aes
labs(x = "Longitud", y = "Latitud",   #cambio detalles
fill = "",
title = "Municipios Urbanos y Rurales",
subtitle = "por Municipio, Mexico",
caption = "Fuente: Censo General de Población y Vivienda 2000") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)+
scale_fill_manual(labels=c("Rural","Urbano","Sin Datos"),
values=c("#BDE7BD", "#FF6962","#EBEBE3")#ponemos colores de cornuda (colores pastel <3)
)
ggsave("Urbanos y Rurales.eps", plot = last_plot(),
path = "outputs",
width = 200, height = 135, units = "mm") #lo guardo como eps
setwd("C:/Users/Joaquin/Desktop/UdeSA/Maestría en Economía/Herramientas Computacionales Para Investigación/Herramientas-Computacionales-Liwski-Sury-Trabajo-Final")
#Cargo Paquetes
suppressMessages({
if(!require("pacman")) install.packages("pacman")
pacman::p_load("tidyverse","readxl","haven","sf","rgdal","RecordLinkage",
"rmapshaper","geojsonio", "gganimate","gapminder","sfheaders",
"xtable", "scales")
})
rm(list=ls())
#cargo los dta
inputfolder<-"Data, figuras y do originales/Data-Original/"
dtas<-list.files(path= inputfolder, recursive = TRUE, include.dirs = TRUE)
for(file in dtas) {
# nombre al cual le asigno cada dta
obj_name <- gsub(".dta", "", file)
#open file
dta_file <- read_dta(paste0(inputfolder,file))
# Assign
assign(obj_name, dta_file)
}
#Borro lo que este de mas
rm(dta_file,dtas,file,obj_name)
#Limpio nombres de merge
merge_ss_eneu_final$descripcion_municipio[which(merge_ss_eneu_final$descripcion_municipio=="")]<-merge_ss_eneu_final$name_ss[which(merge_ss_eneu_final$descripcion_municipio=="")]
#merge_ss_eneu_final$descripcion_municipio<-str_to_title(iconv(merge_ss_eneu_final$descripcion_municipio, to = 'Latin1'))
merge_ss_eneu_final$descripcion_municipio<-str_to_title(merge_ss_eneu_final$descripcion_municipio)
#Inporto SHP
#municipioshp <- read_sf("Data, figuras y do originales/municipios_mx_feb2018/municipios_mx_feb2018.shp") #faster
municipio <- st_read("Data, figuras y do originales/municipios_mx_feb2018/municipios_mx_feb2018.shp", options = "ENCODING=WINDOWS-1252")
municipio <- ms_simplify(municipio) #para que no sea tan pesado
municipio$CVEGEO<-as.numeric(municipio$CVEGEO)
municipio<-municipio%>%left_join(merge_ss_eneu_final, by=c("CVEGEO"="municipality"))
466.4*2
655.52*2
municipiosp<-municipio%>%left_join(benef_SP_2002_2009, by=c("cvemun")) #join con caracteristicas de municipio
#armamos date variables
municipiosp$month<-3*municipiosp$quarter
municipiosp$ind<-ifelse(municipiosp$ind>10,municipiosp$ind,NA)
municipiosp$date<-as.Date(paste0(municipiosp$year,"-",municipiosp$month,"-01"))
options(scipen=999)#para que no aparezca con scientific notation
#GIF SP
mapagif<- ggplot(municipiosp%>%filter(!is.na(date))) +
geom_sf(colour='black', aes(fill=ind), size = 0.000005)+ #tipo de figura y aes
labs(x = "Longitud", y = "Latitud",   #cambio detalles
fill = "",
title = "Seguro Popular - México",
subtitle = "Individuos Adheridos Por Municipio\n{frame_time}",
caption = "Fuente:IMSS") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)+scale_fill_gradient2(low="white",high="black",limits=c(1,286144))+#revertimos el original pattern
transition_time(date)
num_frames <- 29
animate(mapagif,nframes=num_frames,fps=3,duration=10,height = 932.8, width = 1311.04)
anim_save("outputs/SP.gif")
#elimino todo lo que aca se agrega
rm(list = c("num_frames","municipiosp"))
municipiosp<-municipio%>%left_join(benef_SP_2002_2009, by=c("cvemun")) #join con caracteristicas de municipio
#armamos date variables
municipiosp$month<-3*municipiosp$quarter
municipiosp$ind<-ifelse(municipiosp$ind>10,municipiosp$ind,NA)
municipiosp$date<-as.Date(paste0(municipiosp$year,"-",municipiosp$month,"-01"))
options(scipen=999)#para que no aparezca con scientific notation
#GIF SP
mapagif<- ggplot(municipiosp%>%filter(!is.na(date))) +
geom_sf(colour='black', aes(fill=ind), size = 0.000005)+ #tipo de figura y aes
labs(x = "Longitud", y = "Latitud",   #cambio detalles
fill = "",
title = "Seguro Popular - México",
subtitle = "Individuos Adheridos Por Municipio\n{frame_time}",
caption = "Fuente:IMSS") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)+scale_fill_gradient2(low="white",high="black",limits=c(1,286144))+#revertimos el original pattern
transition_time(date)
num_frames <- 30
animate(mapagif,nframes=num_frames,fps=2,duration=15,height = 732.8, width = 1061.04)
anim_save("outputs/SP.gif")
#elimino todo lo que aca se agrega
rm(list = c("num_frames","municipiosp"))
municipiosp<-municipio%>%left_join(benef_SP_2002_2009, by=c("cvemun")) #join con caracteristicas de municipio
#armamos date variables
municipiosp$month<-3*municipiosp$quarter
municipiosp$ind<-ifelse(municipiosp$ind>10,municipiosp$ind,NA)
municipiosp$date<-as.Date(paste0(municipiosp$year,"-",municipiosp$month,"-01"))
options(scipen=999)#para que no aparezca con scientific notation
#GIF SP
mapagif<- ggplot(municipiosp%>%filter(!is.na(date))) +
geom_sf(colour='black', aes(fill=ind), size = 0.000005)+ #tipo de figura y aes
labs(x = "Longitud", y = "Latitud",   #cambio detalles
fill = "Cantidad de Adheridos",
title = "Seguro Popular - México",
subtitle = "Individuos Adheridos Por Municipio\n{frame_time}",
caption = "Fuente:IMSS") +
theme_minimal()+ #lo pongo bonito
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = c(.8,.8),
legend.background = element_blank()
)+scale_fill_gradient2(low="white",high="black",limits=c(1,286144))+#revertimos el original pattern
transition_time(date)
num_frames <- 29
animate(mapagif,nframes=num_frames,fps=2,duration=15,height = 732.8, width = 1061.04)
anim_save("outputs/SP.gif")
#elimino todo lo que aca se agrega
rm(list = c("num_frames","municipiosp"))
