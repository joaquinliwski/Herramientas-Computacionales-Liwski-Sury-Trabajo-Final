#creamos employement agregado
employement<-employees%>%full_join(employers,by=c("municipio","year","quarter"))
employementfull<-employement%>%group_by(year,quarter)%>%
summarise("employees"=sum(emp_t,na.rm=T),"employers"=sum(pat_t,na.rm=T))
#agregamos date variable
employementfull$month<-3*employementfull$quarter
employementfull$date<-as.Date(paste0(employementfull$year,"-",employementfull$month,"-01"))
#Plot trabajo en millions
#axis plot
ylim.prim <- c(12, 16)
ylim.sec <- c(0.75, 0.84)
b <- diff(ylim.prim)/diff(ylim.sec)
a <- ylim.prim[1] - b*ylim.sec[1]
ggplot(employementfull%>%filter(employers>0),aes(x=date))+
geom_line(aes(y=employees/1000000,color="Empleados (en millones)"),linetype = "dashed")+
geom_line(aes(y = (a + employers*b/1000000),color="Empleadores (en millones)"))+
scale_y_continuous(
# Primer Eje
name = "Empleadores (en millones)",
#segundo eje
sec.axis = sec_axis(trans =~ (. - a)/b, name="Empleados (en millones)")
) +labs(x = "Fecha",   #cambio detalles
color = "",
title = "Número de Empleadores y Empleados Afiliados al Seguro Social Mexicano",
subtitle = "Figura 1",
caption = "Fuente: IMSS") +
theme_minimal() +#lo pongo bonito
theme(legend.position="bottom")
setwd("C:/Users/Joaquin/Desktop/UdeSA/Maestría en Economía/Herramientas Computacionales Para Investigación/Herramientas-Computacionales-Liwski-Sury-Trabajo-Final")
#Cargo Paquetes
suppressMessages({
if(!require("pacman")) install.packages("pacman")
pacman::p_load("tidyverse","readxl","haven","sf","rgdal","RecordLinkage",
"rmapshaper","geojsonio", "gganimate","gapminder","sfheaders",
"xtable", "scales")
})
rm(list=ls())
#cargo los dta
inputfolder<-"Data, figuras y do originales/Data-Original/"
dtas<-list.files(path= inputfolder, recursive = TRUE, include.dirs = TRUE)
for(file in dtas) {
# nombre al cual le asigno cada dta
obj_name <- gsub(".dta", "", file)
#open file
dta_file <- read_dta(paste0(inputfolder,file))
# Assign
assign(obj_name, dta_file)
}
#Borro lo que este de mas
rm(dta_file,dtas,file,obj_name)
#Limpio nombres de merge
merge_ss_eneu_final$descripcion_municipio[which(merge_ss_eneu_final$descripcion_municipio=="")]<-merge_ss_eneu_final$name_ss[which(merge_ss_eneu_final$descripcion_municipio=="")]
#merge_ss_eneu_final$descripcion_municipio<-str_to_title(iconv(merge_ss_eneu_final$descripcion_municipio, to = 'Latin1'))
merge_ss_eneu_final$descripcion_municipio<-str_to_title(merge_ss_eneu_final$descripcion_municipio)
#Inporto SHP
#municipioshp <- read_sf("Data, figuras y do originales/municipios_mx_feb2018/municipios_mx_feb2018.shp") #faster
municipio <- st_read("Data, figuras y do originales/municipios_mx_feb2018/municipios_mx_feb2018.shp", options = "ENCODING=WINDOWS-1252")
municipio <- ms_simplify(municipio) #para que no sea tan pesado
municipio$CVEGEO<-as.numeric(municipio$CVEGEO)
municipio<-municipio%>%left_join(merge_ss_eneu_final, by=c("CVEGEO"="municipality"))
#creamos employement agregado
employement<-employees%>%full_join(employers,by=c("municipio","year","quarter"))
employementfull<-employement%>%group_by(year,quarter)%>%
summarise("employees"=sum(emp_t,na.rm=T),"employers"=sum(pat_t,na.rm=T))
#agregamos date variable
employementfull$month<-3*employementfull$quarter
employementfull$date<-as.Date(paste0(employementfull$year,"-",employementfull$month,"-01"))
#Plot trabajo en millions
#axis plot
ylim.prim <- c(12, 16)
ylim.sec <- c(0.75, 0.84)
b <- diff(ylim.prim)/diff(ylim.sec)
a <- ylim.prim[1] - b*ylim.sec[1]
ggplot(employementfull%>%filter(employers>0),aes(x=date))+
geom_line(aes(y=employees/1000000,color="Empleados (en millones)"),linetype = "dashed")+
geom_line(aes(y = (a + employers*b/1000000),color="Empleadores (en millones)"))+
scale_y_continuous(
# Primer Eje
name = "Empleadores (en millones)",
#segundo eje
sec.axis = sec_axis(trans =~ (. - a)/b, name="Empleados (en millones)")
) +labs(x = "Fecha",   #cambio detalles
color = "",
title = "Número de Empleadores y Empleados Afiliados al Seguro Social Mexicano",
subtitle = "Figura 1",
caption = "Fuente: IMSS") +
theme_minimal() +#lo pongo bonito
theme(legend.position="bottom")
ggplot(employementfull%>%filter(employers>0),aes(x=date))+
geom_line(aes(y=employees/1000000,color="Empleados (en millones)"),linetype = "dashed")+
geom_line(aes(y = (a + employers*b/1000000),color="Empleadores (en millones)"))+
scale_y_continuous(
# Primer Eje
name = "Empleados (en millones)",
#segundo eje
sec.axis = sec_axis(trans =~ (. - a)/b, name="Empleadores (en millones)")
) +labs(x = "Fecha",   #cambio detalles
color = "",
title = "Número de Empleadores y Empleados Afiliados al Seguro Social Mexicano",
subtitle = "Figura 1",
caption = "Fuente: IMSS") +
theme_minimal() +#lo pongo bonito
theme(legend.position="bottom")
ggsave("employement.eps", plot = last_plot(),
path = "outputs",
width = 200, height = 135, units = "mm") #lo guardo como eps
